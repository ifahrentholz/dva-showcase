{"version":3,"file":"dva-m-rating-box.EUAq6r8X.js","sources":["../../src/components/dva-m-rating-box/dva-m-rating-box.template.ts","../../src/components/dva-m-rating-box/dva-m-rating-box.ts"],"sourcesContent":["import { html } from \"lit-html\";\n\nimport { DvaRatingBox } from \"./dva-m-rating-box\";\n\ntype FilledOptions = \"no\" | \"half\" | \"full\";\n\nconst renderRatingStar = (filled: FilledOptions, starIdx: number, ratingBox: DvaRatingBox) => {\n  return html`\n    <dva-e-icon\n      class=\"dva-e-rating-star${filled !== \"no\" ? ` dva-e-rating-star--${filled}` : \"\"}\"\n      icon-id=\"dva-icon-star\"\n      ?half-filled=${filled === \"half\"}\n      @click=${() => {\n        if (ratingBox.editMode) ratingBox.rating = starIdx + 1;\n      }}\n    ></dva-e-icon>\n  `;\n};\n\ntype RatingBoxTemplateArgs = {\n  curRating: number;\n  ratingBox: DvaRatingBox;\n};\n\n/**\n * True, if given star should be shown as Full Star\n * @param {number} rating - current rating\n * @param {number} index - index of given star\n * @returns {boolean}\n */\nconst isFullStar = (rating: number, index: number): boolean => {\n  return index + 0.5 < rating;\n};\n\n/**\n * True, if given star should be shown as Half Star\n * @param {number} rating - current rating\n * @param {number} index - index of given star\n * @returns {boolean}\n */\nconst isHalfStar = (rating: number, index: number): boolean => {\n  return index + 1 > rating && index + 0.1 <= rating;\n};\n\nconst getStarOptions = (args: RatingBoxTemplateArgs): Array<FilledOptions> => {\n  return new Array(5).fill(true).map((_value, idx) => {\n    if (isFullStar(args.curRating, idx)) return \"full\";\n    if (isHalfStar(args.curRating, idx)) return \"half\";\n    return \"no\";\n  });\n};\n\nexport const ratingBoxTemplate = (args: RatingBoxTemplateArgs) => {\n  return html`\n    <div class=\"dva-m-rating-box__ratingstar-wrapper\">\n      ${getStarOptions(args).map((filled: FilledOptions, starIdx: number) =>\n        renderRatingStar(filled, starIdx, args.ratingBox),\n      )}\n    </div>\n    <span class=\"dvag-e-form-field__error\">\n      <dva-e-icon class=\"dvag-e-form-field__error-icon\" icon-id=\"dva-icon-error-16px\"></dva-e-icon> Bitte bewerten Sie.\n    </span>\n  `;\n};\n","import { Component, prop } from \"@kluntje/core\";\nimport { ViewportObserver } from \"@kluntje/services\";\nimport { removeEvent, toggleClass } from \"@kluntje/js-utils/lib/dom-helpers\";\nimport { render } from \"lit-html\";\nimport { ERROR } from \"Constants/cssClasses\";\nimport { IN_VIEWPORT_EVENT } from \"Constants/eventTypes\";\n\nimport { ratingBoxTemplate } from \"./dva-m-rating-box.template\";\n\nexport class DvaRatingBox extends Component {\n  viewportObserver = ViewportObserver.getInstance();\n\n  @prop\n  editMode = false;\n\n  constructor() {\n    super({\n      events: [\n        {\n          event: IN_VIEWPORT_EVENT,\n          target: \"this\",\n          handler: \"handleIntersectionChange\",\n        },\n      ],\n      initialStates: {\n        loaded: false,\n        inValidationMode: false,\n      },\n      reactions: {\n        inValidationMode: [\"renderComponent\"],\n      },\n    });\n  }\n\n  static get observedAttributes() {\n    return [\"rating\"];\n  }\n\n  attributeChangedCallback(name: string, oldValue: any, newValue: any) {\n    if (name === \"rating\" && oldValue !== newValue && this.state.initialized) {\n      this.renderComponent();\n    }\n  }\n\n  afterComponentRender(): void {\n    this.viewportObserver.observe(this);\n  }\n\n  get rating() {\n    return parseFloat((this.getAttribute(\"rating\") || \"5\").replace(\",\", \".\"));\n  }\n\n  set rating(newRating: number) {\n    this.setAttribute(\"rating\", newRating.toString());\n  }\n\n  get name(): string {\n    return this.getAttribute(\"name\") || \"\";\n  }\n\n  /**\n   * Handles Intersection Change, by removing viewportObserver\n   * and initializing ImageLoad\n   */\n  handleIntersectionChange(): void {\n    this.viewportObserver.unobserve(this);\n    removeEvent(this, IN_VIEWPORT_EVENT, this.handleIntersectionChange, this);\n    if (!this.state.loaded) {\n      this.renderComponent();\n    }\n  }\n\n  /**\n   * initially renders the containing stars\n   */\n  renderComponent(): void {\n    if (this.state.inValidationMode) {\n      toggleClass(this, ERROR, this.rating === 0);\n    }\n    render(ratingBoxTemplate({ curRating: this.rating, ratingBox: this }), this);\n  }\n\n  validate() {\n    if (this.editMode) this.setState({ inValidationMode: true });\n  }\n}\n\ncustomElements.define(\"dva-m-rating-box\", DvaRatingBox);\n"],"names":["renderRatingStar","filled","starIdx","ratingBox","html","isFullStar","rating","index","isHalfStar","getStarOptions","args","_value","idx","ratingBoxTemplate","DvaRatingBox","Component","IN_VIEWPORT_EVENT","ViewportObserver","name","oldValue","newValue","newRating","removeEvent","toggleClass","ERROR","render","__decorateClass","prop"],"mappings":"sQAMA,MAAMA,EAAmB,CAACC,EAAuBC,EAAiBC,IACzDC,wCAEuBH,IAAW,KAAO,uBAAuBA,CAAM,GAAK,EAAE,2CAEjEA,IAAW,MAAM,aACvB,IAAM,CACTE,EAAU,WAAUA,EAAU,OAASD,EAAU,EACtD,CAAA,kBAgBDG,EAAa,CAACC,EAAgBC,IAC3BA,EAAQ,GAAMD,EASjBE,EAAa,CAACF,EAAgBC,IAC3BA,EAAQ,EAAID,GAAUC,EAAQ,IAAOD,EAGxCG,EAAkBC,GACf,IAAI,MAAM,CAAC,EAAE,KAAK,EAAI,EAAE,IAAI,CAACC,EAAQC,IACtCP,EAAWK,EAAK,UAAWE,CAAG,EAAU,OACxCJ,EAAWE,EAAK,UAAWE,CAAG,EAAU,OACrC,IACR,EAGUC,EAAqBH,GACzBN,sDAEDK,EAAeC,CAAI,EAAE,IAAI,CAACT,EAAuBC,IACjDF,EAAiBC,EAAQC,EAASQ,EAAK,SAAS,CACjD,CAAA,uWChDA,MAAMI,UAAqBC,CAAU,CAM1C,aAAc,CACN,MAAA,CACJ,OAAQ,CACN,CACE,MAAOC,EACP,OAAQ,OACR,QAAS,0BACX,CACF,EACA,cAAe,CACb,OAAQ,GACR,iBAAkB,EACpB,EACA,UAAW,CACT,iBAAkB,CAAC,iBAAiB,CACtC,CAAA,CACD,EArBH,KAAA,iBAAmBC,EAAiB,cAGzB,KAAA,SAAA,EAmBX,CAEA,WAAW,oBAAqB,CAC9B,MAAO,CAAC,QAAQ,CAClB,CAEA,yBAAyBC,EAAcC,EAAeC,EAAe,CAC/DF,IAAS,UAAYC,IAAaC,GAAY,KAAK,MAAM,aAC3D,KAAK,gBAAgB,CAEzB,CAEA,sBAA6B,CACtB,KAAA,iBAAiB,QAAQ,IAAI,CACpC,CAEA,IAAI,QAAS,CACJ,OAAA,YAAY,KAAK,aAAa,QAAQ,GAAK,KAAK,QAAQ,IAAK,GAAG,CAAC,CAC1E,CAEA,IAAI,OAAOC,EAAmB,CAC5B,KAAK,aAAa,SAAUA,EAAU,SAAU,CAAA,CAClD,CAEA,IAAI,MAAe,CACV,OAAA,KAAK,aAAa,MAAM,GAAK,EACtC,CAMA,0BAAiC,CAC1B,KAAA,iBAAiB,UAAU,IAAI,EACpCC,EAAY,KAAMN,EAAmB,KAAK,yBAA0B,IAAI,EACnE,KAAK,MAAM,QACd,KAAK,gBAAgB,CAEzB,CAKA,iBAAwB,CAClB,KAAK,MAAM,kBACbO,EAAY,KAAMC,EAAO,KAAK,SAAW,CAAC,EAErCC,EAAAZ,EAAkB,CAAE,UAAW,KAAK,OAAQ,UAAW,IAAA,CAAM,EAAG,IAAI,CAC7E,CAEA,UAAW,CACL,KAAK,UAAU,KAAK,SAAS,CAAE,iBAAkB,EAAM,CAAA,CAC7D,CACF,CAxEEa,EAAA,CADCC,CAAA,EAHUb,EAIX,UAAA,WAAA,CAAA,EA0EF,eAAe,OAAO,mBAAoBA,CAAY"}