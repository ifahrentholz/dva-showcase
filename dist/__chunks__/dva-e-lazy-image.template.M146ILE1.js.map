{"version":3,"file":"dva-e-lazy-image.template.M146ILE1.js","sources":["../../src/utils/renderCssClasses.ts","../../src/components/dva-e-lazy-image/dva-e-lazy-image.template.ts"],"sourcesContent":["export const renderCssClasses = (cssClasses?: string) => {\n  if (cssClasses === undefined) return \"\";\n  return ` ${cssClasses}`;\n};\n","import { html, nothing } from \"lit-html\";\nimport { ifDefined } from \"lit-html/directives/if-defined.js\";\nimport { ANIMATE } from \"Constants/cssClasses\";\nimport { renderIcon } from \"Components/icon/dva-e-icon.template\";\nimport { renderCssClasses } from \"Utils/renderCssClasses\";\n\nimport { DVALazyImage } from \"./dva-e-lazy-image\";\nimport dvaELazyImageShadowScss from \"./dva-e-lazy-image.shadow.scss?inline\";\nimport { RenderLazyImageArgs } from \"./dva-e-lazy-image.types\";\n\ntype LazyImageTemplateParameter = {\n  alt?: string;\n  srcset?: string;\n  sizes?: string;\n  wrapper?: string;\n  component: DVALazyImage;\n};\n\nconst getObjectFitVal = (aspectRatio: string | null) => {\n  if (aspectRatio === \"cover\") return \"cover\";\n  if (aspectRatio === \"contain\") return \"contain\";\n  return \"fill\";\n};\n\nconst getObjectPositionVal = () => {\n  return \"50% 50%\";\n};\n\nconst getAspectRatioClass = (aspectRatio: string | null) => {\n  if (aspectRatio === \"21:9\") return \"dva-e-lazy-image__mask dva-e-lazy-image__mask--21-9\";\n  if (aspectRatio === \"16:9\") return \"dva-e-lazy-image__mask dva-e-lazy-image__mask--16-9\";\n  if (aspectRatio === \"4:3\") return \"dva-e-lazy-image__mask dva-e-lazy-image__mask--4-3\";\n  if (aspectRatio === \"3:2\") return \"dva-e-lazy-image__mask dva-e-lazy-image__mask--3-2\";\n  if (aspectRatio === \"1:1\") return \"dva-e-lazy-image__mask dva-e-lazy-image__mask--1-1\";\n  if (aspectRatio === \"2:3\") return \"dva-e-lazy-image__mask dva-e-lazy-image__mask--2-3\";\n  if (aspectRatio === \"4:5\") return \"dva-e-lazy-image__mask dva-e-lazy-image__mask--4-5\";\n  if (aspectRatio === \"cover\") return \"dva-e-lazy-image__no-ratio dva-e-lazy-image__cover\";\n  if (aspectRatio === \"contain\") return \"dva-e-lazy-image__no-ratio dva-e-lazy-image__contain\";\n  return \"dva-e-lazy-image__no-ratio\";\n};\n\nconst shouldRenderErrorPlaceholder = (args: LazyImageTemplateParameter) => {\n  return !(args.component.hasError === false || args.component.loadingPlaceholderLoaded === true);\n};\n\nconst renderErrorPlaceholder = (args: LazyImageTemplateParameter, forceRender = false) => {\n  if (forceRender === false && !shouldRenderErrorPlaceholder(args)) return \"\";\n\n  return html`\n    <div class=\"dva-e-lazy-image__error-placeholder-box ${args.component.hasError ? ANIMATE : \"\"}\">\n      ${renderIcon(\"dva-icon-image-gallery-72px\", \"dva-e-lazy-image__error-placeholder\")}\n    </div>\n  `;\n};\n\nconst isSvg = (src: string) => {\n  return src.endsWith(\".svg\");\n};\n\nconst getWebpSrcFromSrc = (src: string, width?: string) => {\n  try {\n    src = src.replace(/\\.[^/.]+$/, \".webp\");\n    if (isSvg(src) || src === \"\") return src;\n    new URL(src);\n    const url = new URL(src);\n    url.searchParams.set(\"width\", width ? width : \"750\");\n    url.searchParams.set(\"format\", \"webply\");\n    url.searchParams.set(\"optimize\", \"medium\");\n    return url.href;\n  } catch (e) {\n    console.error(\"Error while creating webp src\", e);\n    return \"\";\n  }\n};\n\nconst renderPlaceholder = (args: LazyImageTemplateParameter) => {\n  if (args.component.noPlaceholder === true) return nothing;\n  if (args.component.loadingPlaceholder === \"\" || args.component.loadingPlaceholderLoadingError === true) {\n    return renderErrorPlaceholder(args, true);\n  }\n\n  return html`\n    <picture\n      class=\"dva-e-lazy-image__picture dva-js-lazy-image__picture--placeholder dva-e-lazy-image__picture--placeholder\"\n    >\n      ${isSvg(args.component.loadingPlaceholder)\n        ? nothing\n        : html`<source type=\"image/webp\" src=\"${getWebpSrcFromSrc(args.component.loadingPlaceholder)}\" />`}\n      <img\n        draggable=\"false\"\n        class=\"dva-e-lazy-image__img dva-e-lazy-image__img--placeholder\"\n        fetchpriority=${ifDefined(args.component.fetchPriority)}\n        loading=${ifDefined(args.component.loading)}\n        alt=\"${args.alt}\"\n        src=\"${args.component.loadingPlaceholder}\"\n        @load=${() => {\n          args.component.loadingPlaceholderLoaded = true;\n          args.component.loadingPlaceholderLoadingError = false;\n        }}\n        @error=${() => {\n          args.component.loadingPlaceholderLoaded = false;\n          args.component.loadingPlaceholderLoadingError = true;\n        }}\n        data-object-fit=${getObjectFitVal(args.component.imgAspectRatio)}\n        data-object-position=${getObjectPositionVal()}\n      />\n    </picture>\n  `;\n};\n\nconst getWebpSrcSetFromSrcSet = (srcset: string) => {\n  return srcset\n    .split(\",\")\n    .map(src => {\n      const [srcUrl, srcWidth] = src.trim().split(\" \");\n      return `${getWebpSrcFromSrc(srcUrl, srcWidth)} ${srcWidth}`;\n    })\n    .join(\", \");\n};\n\nexport const lazyImageTemplate = (args: LazyImageTemplateParameter) => {\n  return html`\n    <style>\n      ${dvaELazyImageShadowScss}\n    </style>\n    <div class=\"${getAspectRatioClass(args.component.imgAspectRatio)}\">\n      <div class=\"dva-e-lazy-image__wrapper dva-js-lazy-image__wrapper\">\n        ${renderPlaceholder(args)}\n        <picture class=\"dva-e-lazy-image__picture dva-js-lazy-image__picture\">\n          ${isSvg(args.component.imgSrc)\n            ? nothing\n            : html`<source\n                type=\"image/webp\"\n                src=\"${getWebpSrcFromSrc(args.component.imgSrc)}\"\n                srcset=\"${getWebpSrcSetFromSrcSet(args.srcset || args.component.imgSrcSet)}\"\n              />`}\n          <img\n            draggable=\"false\"\n            class=\"dva-js-lazy-image__img dva-e-lazy-image__img\"\n            src=\"\"\n            srcset=\"${args.srcset}\"\n            alt=\"${args.alt}\"\n            sizes=\"${args.sizes}\"\n            fetchpriority=${ifDefined(args.component.fetchPriority)}\n            loading=${ifDefined(args.component.loading)}\n            data-object-fit=${getObjectFitVal(args.component.imgAspectRatio)}\n            data-object-position=${getObjectPositionVal()}\n          />\n        </picture>\n        ${renderErrorPlaceholder(args)}\n      </div>\n    </div>\n  `;\n};\n\nexport const renderLazyImage = (args: RenderLazyImageArgs) => {\n  return html`\n    <dva-e-lazy-image\n      class=\"dva-e-lazy-image${renderCssClasses(args.cssClasses)}\"\n      src=\"${args.src}\"\n      alt=${ifDefined(args.alt)}\n      srcset=${ifDefined(args.srcset)}\n      sizes=${ifDefined(args.sizes)}\n      loading-placeholder=${ifDefined(args.loadingPlaceholder)}\n      aspect-ratio=${ifDefined(args.aspectRatio)}\n      wrapper=${ifDefined(args.wrapper)}\n    >\n    </dva-e-lazy-image>\n  `;\n};\n\nexport interface RenderLazyImagePlaceholderArgs {\n  cssClasses?: string;\n  aspectRatio: string;\n}\n\nexport const renderLazyImagePlaceholder = (args: RenderLazyImagePlaceholderArgs) => {\n  return html`\n    <div\n      class=\"dva-e-lazy-image dva-e-lazy-image--placeholder${renderCssClasses(args.cssClasses)}\"\n      aspect-ratio=\"${args.aspectRatio}\"\n    >\n      <div class=\"dva-e-lazy-image__placeholder-content\">\n        ${renderIcon(\"dva-icon-image-gallery-72px\", \"dva-e-lazy-image__placeholder-icon\")}\n      </div>\n    </div>\n  `;\n};\n"],"names":["renderCssClasses","cssClasses","getObjectFitVal","aspectRatio","getObjectPositionVal","getAspectRatioClass","shouldRenderErrorPlaceholder","args","renderErrorPlaceholder","forceRender","html","ANIMATE","renderIcon","isSvg","src","getWebpSrcFromSrc","width","url","e","renderPlaceholder","nothing","ifDefined","getWebpSrcSetFromSrcSet","srcset","srcUrl","srcWidth","lazyImageTemplate","dvaELazyImageShadowScss","renderLazyImage"],"mappings":"qMAAa,MAAAA,EAAoBC,GAC3BA,IAAe,OAAkB,GAC9B,IAAIA,CAAU,o9KCgBjBC,EAAmBC,GACnBA,IAAgB,QAAgB,QAChCA,IAAgB,UAAkB,UAC/B,OAGHC,EAAuB,IACpB,UAGHC,EAAuBF,GACvBA,IAAgB,OAAe,sDAC/BA,IAAgB,OAAe,sDAC/BA,IAAgB,MAAc,qDAC9BA,IAAgB,MAAc,qDAC9BA,IAAgB,MAAc,qDAC9BA,IAAgB,MAAc,qDAC9BA,IAAgB,MAAc,qDAC9BA,IAAgB,QAAgB,qDAChCA,IAAgB,UAAkB,uDAC/B,6BAGHG,EAAgCC,GAC7B,EAAEA,EAAK,UAAU,WAAa,IAASA,EAAK,UAAU,2BAA6B,IAGtFC,EAAyB,CAACD,EAAkCE,EAAc,KAC1EA,IAAgB,IAAS,CAACH,EAA6BC,CAAI,EAAU,GAElEG,wDACiDH,EAAK,UAAU,SAAWI,EAAU,EAAE,KACxFC,EAAW,8BAA+B,qCAAqC,CAAC,SAKlFC,EAASC,GACNA,EAAI,SAAS,MAAM,EAGtBC,EAAoB,CAACD,EAAaE,IAAmB,CACrD,GAAA,CAEE,GADEF,EAAAA,EAAI,QAAQ,YAAa,OAAO,EAClCD,EAAMC,CAAG,GAAKA,IAAQ,GAAW,OAAAA,EACrC,IAAI,IAAIA,CAAG,EACL,MAAAG,EAAM,IAAI,IAAIH,CAAG,EACvB,OAAAG,EAAI,aAAa,IAAI,QAASD,GAAgB,KAAK,EAC/CC,EAAA,aAAa,IAAI,SAAU,QAAQ,EACnCA,EAAA,aAAa,IAAI,WAAY,QAAQ,EAClCA,EAAI,WACJC,EAAG,CACF,eAAA,MAAM,gCAAiCA,CAAC,EACzC,EACT,CACF,EAEMC,EAAqBZ,GACrBA,EAAK,UAAU,gBAAkB,GAAaa,EAC9Cb,EAAK,UAAU,qBAAuB,IAAMA,EAAK,UAAU,iCAAmC,GACzFC,EAAuBD,EAAM,EAAI,EAGnCG,8HAIDG,EAAMN,EAAK,UAAU,kBAAkB,EACrCa,EACAV,mCAAsCK,EAAkBR,EAAK,UAAU,kBAAkB,CAAC,IAAM,2GAIlFc,EAAUd,EAAK,UAAU,aAAa,CAAC,cAC7Cc,EAAUd,EAAK,UAAU,OAAO,CAAC,UACpCA,EAAK,GAAG,UACRA,EAAK,UAAU,kBAAkB,YAChC,IAAM,CACZA,EAAK,UAAU,yBAA2B,GAC1CA,EAAK,UAAU,+BAAiC,EACjD,CAAA,aACQ,IAAM,CACbA,EAAK,UAAU,yBAA2B,GAC1CA,EAAK,UAAU,+BAAiC,EAAA,CACjD,sBACiBL,EAAgBK,EAAK,UAAU,cAAc,CAAC,2BACzCH,GAAsB,eAM/CkB,EAA2BC,GACxBA,EACJ,MAAM,GAAG,EACT,IAAWT,GAAA,CACJ,KAAA,CAACU,EAAQC,CAAQ,EAAIX,EAAI,OAAO,MAAM,GAAG,EAC/C,MAAO,GAAGC,EAAkBS,EAAQC,CAAQ,CAAC,IAAIA,CAAQ,EAAA,CAC1D,EACA,KAAK,IAAI,EAGDC,EAAqBnB,GACzBG,WAEDiB,CAAuB,uBAEbtB,EAAoBE,EAAK,UAAU,cAAc,CAAC,uEAE1DY,EAAkBZ,CAAI,CAAC,yEAErBM,EAAMN,EAAK,UAAU,MAAM,EACzBa,EACAV,mCAESK,EAAkBR,EAAK,UAAU,MAAM,CAAC,aACrCe,EAAwBf,EAAK,QAAUA,EAAK,UAAU,SAAS,CAAC,IACzE,+FAKKA,EAAK,MAAM,UACdA,EAAK,GAAG,YACNA,EAAK,KAAK,oBACHc,EAAUd,EAAK,UAAU,aAAa,CAAC,cAC7Cc,EAAUd,EAAK,UAAU,OAAO,CAAC,sBACzBL,EAAgBK,EAAK,UAAU,cAAc,CAAC,2BACzCH,GAAsB,eAG/CI,EAAuBD,CAAI,CAAC,eAMzBqB,EAAmBrB,GACvBG,6CAEsBV,EAAiBO,EAAK,UAAU,CAAC,UACnDA,EAAK,GAAG,UACTc,EAAUd,EAAK,GAAG,CAAC,aAChBc,EAAUd,EAAK,MAAM,CAAC,YACvBc,EAAUd,EAAK,KAAK,CAAC,0BACPc,EAAUd,EAAK,kBAAkB,CAAC,mBACzCc,EAAUd,EAAK,WAAW,CAAC,cAChCc,EAAUd,EAAK,OAAO,CAAC"}