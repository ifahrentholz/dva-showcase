import{U as L,R as w,S as b}from"./component.module.D5fmAfIh.js";import{l as E,y as S,e as I,a as r,r as g,c as n,o as c,p as A}from"./index.module.BEmWgxQc.js";import{E as _,c as P,H as d,I as C,d as m,L as p}from"./cssClasses.CIN72OsW.js";import{j as u}from"./lit-element.XkUWx5ik.js";import{m as z}from"./mediaQueries.0eOxrCUs.js";import{g as y}from"./getSrcset.ehtWqR_R.js";import{l as f}from"./dva-e-lazy-image.template.ZrSM01wa.js";var O=Object.defineProperty,D=Object.getOwnPropertyDescriptor,v=(e,t,a,s)=>{for(var i=s>1?void 0:s?D(t,a):t,h=e.length-1,l;h>=0;h--)(l=e[h])&&(i=(s?l(t,a,i):l(i))||i);return s&&i&&O(t,a,i),i};let o=class extends L{constructor(){super({ui:{image:".dva-js-lazy-image__img :-one",placeholder:".dva-e-lazy-image__img--placeholder :-one",wrapper:".dva-js-lazy-image__wrapper :-one"},initialStates:{imgLoaded:!1},useShadowDOM:!0}),this.viewportObserver=E.getInstance(),this._hasError=!1,this._loadingPlaceholderLoaded=!1,this._loadingPlaceholderLoadingError=!1}connectedCallback(){this.initType==="lazy"?S.subscribe(this,()=>super.connectedCallback()):super.connectedCallback()}get DEFAULT_FALLBACK_IMAGE(){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 9'%3E%3C/svg%3E"}get fallbackImg(){return this.getAttribute("fallback-image")||this.DEFAULT_FALLBACK_IMAGE}get imgSrc(){return this.getAttribute("src")||""}get imgSrcSet(){return this.getAttribute("srcset")||this.getSrcsetFromSrc()}get imgSizes(){return this.getAttribute("sizes")||""}get imgAlt(){return this.getAttribute("alt")||""}get imgAspectRatio(){return this.getAttribute("aspect-ratio")}get imgWrapper(){return this.getAttribute("wrapper")||""}get noPlaceholder(){return this.hasAttribute("no-placeholder")&&this.getAttribute("no-placeholder")!=="false"}get hasOverWidth(){return this.ui.image.offsetHeight<this.offsetHeight}get hasError(){return this._hasError}set hasError(e){this.hasError!==e&&(this._hasError=e,this.updateComponent(),I(this.ui.wrapper,_,e))}get hasLoadingPlaceholder(){return this.loadingPlaceholder!==""}get loadingPlaceholderLoaded(){return!this.hasLoadingPlaceholder||this._loadingPlaceholderLoaded}set loadingPlaceholderLoaded(e){this.loadingPlaceholderLoaded!==e&&(this._loadingPlaceholderLoaded=e)}get loadingPlaceholderLoadingError(){return!this.hasLoadingPlaceholder||this._loadingPlaceholderLoadingError}set loadingPlaceholderLoadingError(e){this.loadingPlaceholderLoadingError!==e&&(this._loadingPlaceholderLoadingError=e,this.updateComponent())}static get observedAttributes(){return["src","srcset","aspect-ratio"]}get initType(){switch(this.getAttribute("init")){case"explicit":return"explicit";default:return"lazy"}}getLoadingPlaceholderFromSrc(){const e=new URL(this.imgSrc);return e.searchParams.get("width")?(e.searchParams.set("width","60"),e.href):this.imgSrc}getSrcsetFromSrc(){const e=new URL(this.imgSrc);return e.searchParams.get("width")?y(e.href,[480,760,1024,1280,1440,1460,2e3]):""}get loadingPlaceholder(){return this.getAttribute("loading-placeholder")||this.getLoadingPlaceholderFromSrc()}attributeChangedCallback(e,t,a){if(!(t===a||!this.state.initialized))switch(e){case"src":this.setState({imgLoaded:!1}),this.loadImage();break;case"srcset":this.setState({imgLoaded:!1}),this.loadImage();break;case"aspect-ratio":this.renderComponent(),this.handleOverwidth();break}}renderComponent(){u(f({alt:this.imgAlt,srcset:"",sizes:this.imgSizes,component:this,wrapper:this.imgWrapper}),this.getUiRoot())}updateComponent(){u(f({alt:this.imgAlt,srcset:this.imgSrcSet,sizes:this.imgSizes,component:this}),this.getUiRoot())}afterComponentRender(){r(this,P),g(this.ui.wrapper,d),this.initType!=="explicit"&&this.viewportObserver.observe(this)}beforeComponentDisconnects(){r(this.ui.wrapper,d)}destroyComponent(){this.setState({imgLoaded:!1})}loadImage(){if(this.viewportObserver.unobserve(this),this.state.imgLoaded)return;r(this,C),r(this.ui.wrapper,m);const e=this.ui.image;this.attachImageEvents(e),this.imgSrc||this.imgSrcSet?(this.imgSrc&&e.setAttribute("src",this.imgSrc),this.imgSrcSet&&e.setAttribute("srcset",this.imgSrcSet)):console.warn("LazyImage: no src/srcset provided for",e)}handleImageLoadingError(){const e=this.ui.image;n(e,"error",this.handleImageLoadingError,this),this.hasError=!0,console.log("lazyImg error:",e)}handleImageLoad(){this.handleOverwidth(),this.hasError=!1,n(this.ui.image,"load",this.handleImageLoad,this),g(this.ui.wrapper,m),r(this,p),r(this.ui.image,p),r(this.ui.placeholder,d),this.dispatchEvent(new CustomEvent("dva-image-loaded",{detail:{target:this}})),this.setState({imgLoaded:!0})}attachImageEvents(e){c(e,"load",this.handleImageLoad,this),c(e,"error",this.handleImageLoadingError,this)}handleOverwidth(){g(this.ui.wrapper,"dva-e-lazy-image__wrapper--has-overwidth"),this.hasOverWidth&&r(this.ui.wrapper,"dva-e-lazy-image__wrapper--has-overwidth")}};v([w("this",A)],o.prototype,"loadImage",1);o=v([b(z)],o);customElements.define("dva-e-lazy-image",o);
//# sourceMappingURL=dva-e-lazy-image.UCrOhMiV.js.map
