import{U as b,I as v,H as g,a as f,L as m,b as I,S as A}from"./cssClasses.-Nv2SymR.js";import{a,r as h,b as l,o as p}from"./index.module.s_GEwl_l.js";import{j as d}from"./lit-element.XkUWx5ik.js";import{m as w}from"./mediaQueries.0eOxrCUs.js";import{t as u}from"./dva-e-lazy-image.template.OYQsP62C.js";class L{constructor(){this.componentMap=new WeakMap,this.intersectionObserver=new IntersectionObserver(e=>this.handleIntersectionChange(e))}subscribe(e,i){this.componentMap.set(e,i),this.intersectionObserver.observe(e)}unsubscribe(e){this.intersectionObserver.unobserve(e),this.componentMap.delete(e)}handleIntersectionChange(e){e.forEach(i=>{const r=i.target;if(!i.isIntersecting||!this.componentMap.has(r))return;const s=this.componentMap.get(r);this.unsubscribe(r),s()})}}const S=new L;var C=Object.defineProperty,E=Object.getOwnPropertyDescriptor,_=(t,e,i,r)=>{for(var s=r>1?void 0:r?E(e,i):e,n=t.length-1,o;n>=0;n--)(o=t[n])&&(s=(r?o(e,i,s):o(s))||s);return r&&s&&C(e,i,s),s};let c=class extends b{constructor(){super({ui:{image:".dva-js-lazy-image__img :-one",wrapper:".dva-js-lazy-image__wrapper :-one"},initialStates:{imgLoaded:!1},useShadowDOM:!0})}connectedCallback(){this.initType==="lazy"?S.subscribe(this,()=>super.connectedCallback()):super.connectedCallback()}get DEFAULT_FALLBACK_IMAGE(){return"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 9'%3E%3C/svg%3E"}get fallbackImg(){return this.getAttribute("fallback-image")||this.DEFAULT_FALLBACK_IMAGE}get imgSrc(){return this.getAttribute("src")||""}get imgSrcSet(){return this.getAttribute("srcset")||""}get imgSizes(){return this.getAttribute("sizes")||""}get imgAlt(){return this.getAttribute("alt")||""}get imgAspectRatio(){return this.getAttribute("aspect-ratio")||""}get imgWrapper(){return this.getAttribute("wrapper")||""}get hasOverWidth(){return this.ui.image.offsetHeight<this.offsetHeight}static get observedAttributes(){return["src","aspect-ratio"]}get initType(){switch(this.getAttribute("init")){case"explicit":return"explicit";default:return"lazy"}}attributeChangedCallback(t,e,i){if(!(e===i||!this.state.initialized))switch(t){case"src":this.setState({imgLoaded:!1}),this.loadImage();break;case"aspect-ratio":this.renderComponent(),this.handleOverwidth();break}}renderComponent(){d(u({alt:this.imgAlt,src:this.DEFAULT_FALLBACK_IMAGE,srcset:"",sizes:this.imgSizes,aspectRatio:this.imgAspectRatio,wrapper:this.imgWrapper,fallbackImg:this.fallbackImg}),this.getUiRoot())}updateComponent(){d(u({alt:this.imgAlt,src:this.imgSrc,srcset:this.imgSrcSet,sizes:this.imgSizes,aspectRatio:this.imgAspectRatio,fallbackImg:this.fallbackImg}),this.getUiRoot())}afterComponentRender(){a(this,v),h(this.ui.wrapper,g),this.initType!=="explicit"&&this.loadImage()}beforeComponentDisconnects(){a(this.ui.wrapper,g)}destroyComponent(){this.setState({imgLoaded:!1})}loadImage(){if(this.state.imgLoaded)return;a(this,f),a(this.ui.wrapper,m);const t=this.ui.image;this.attachImageEvents(t),this.imgSrc||this.imgSrcSet?(this.imgSrc&&t.setAttribute("src",this.imgSrc),this.imgSrcSet&&t.setAttribute("srcset",this.imgSrcSet)):console.warn("LazyImage: no src/srcset provided for",t)}handleImageLoadingError(){const t=this.ui.image;l(t,"error",this.handleImageLoadingError,this),console.log("src",this.fallbackImg),t.setAttribute("src",this.fallbackImg),t.setAttribute("srcset",""),console.log("lazyImg error:",t)}handleImageLoad(){this.handleOverwidth(),l(this.ui.image,"load",this.handleImageLoad,this),h(this.ui.wrapper,m),a(this,I),this.dispatchEvent(new CustomEvent("dva-image-loaded",{detail:{target:this}})),this.setState({imgLoaded:!0})}attachImageEvents(t){p(t,"load",this.handleImageLoad,this),p(t,"error",this.handleImageLoadingError,this)}handleOverwidth(){h(this.ui.wrapper,"dva-e-lazy-image__wrapper--has-overwidth"),this.hasOverWidth&&a(this.ui.wrapper,"dva-e-lazy-image__wrapper--has-overwidth")}};c=_([A(w)],c);customElements.define("dva-e-lazy-image",c);export{S as L};
//# sourceMappingURL=dva-e-lazy-image.hotQpC7D.js.map
