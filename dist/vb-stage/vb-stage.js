import{c as O}from"../__chunks__/cleanUpBlock.VYQGZKWT.js";import{x as m,j as S}from"../__chunks__/lit-element.XkUWx5ik.js";import{U as _,h as x,r as z,p as w,S as P,O as q,M as B,R as j}from"../__chunks__/component.module.CfHwP-qy.js";import{l as V,j as g,g as E,a as o,k as c,o as C,r as l,b as L,h as y}from"../__chunks__/index.module.dAHZ1emY.js";import{b as D,L as v,c as u,E as A}from"../__chunks__/cssClasses.EViQloVa.js";import{m as f}from"../__chunks__/mediaQueries.0eOxrCUs.js";import{I as h,M as $}from"../__chunks__/eventTypes.SwAZPC1U.js";import"../__chunks__/dva-e-lazy-image._afu31lf.js";import"../__chunks__/dva-e-icon.SOrbdysM.js";import"../__chunks__/dva-e-lazy-image.template.r7GCQvhd.js";import"../__chunks__/if-defined.JfW-uEqn.js";import"../__chunks__/dva-e-icon.template.tppk8KWP.js";import"../__chunks__/preload-helper.hlDPvxQM.js";import"../__chunks__/LazyConnectService.yBR27czX.js";const N=t=>t.fallbackSrc!==void 0&&t.fallbackSrc!=="undefined"?t.fallbackSrc:"",Q=t=>{let e="";return t.forEach(s=>{e+=`<video class="dva-e-lazy-video__video dva-js-lazy-video__video"
                      autoplay muted loop playsinline
                      poster="${N(s)}">`,s.sources.forEach(i=>{const a=i.outerHTML;e+=a}),e+="</video>"}),e},T=t=>`${Q(t.sources)}`;var H=Object.defineProperty,U=Object.getOwnPropertyDescriptor,W=(t,e,s,i)=>{for(var a=i>1?void 0:i?U(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(a=(i?n(e,s,a):n(a))||a);return i&&a&&H(e,s,a),a};let p=class extends _{constructor(){super({ui:{video:".dva-js-lazy-video__video"},events:[{event:h,target:"this",handler:"handleIntersectionChange"},{event:$,target:"window",handler:"handleMQChange"},{event:"beforeunload",target:"window",handler:"unloadVideo"},{event:"pageshow",target:"window",handler:"handleVideoLoad"}],initialStates:{activeRendition:null},reactions:{activeRendition:["loadVideo"]}}),this.viewportObserver=V.getInstance()}renderingTemplate(){return T({sources:this.sources})}afterComponentRender(){this.viewportObserver.observe(this)}get sources(){if(this.videoSources)return this.videoSources;const t=g(this,"source"),e=new Map;return t.forEach(i=>{let a=i.dataset.dvaMq;if(a===void 0&&(a="1-5"),e.has(a)){const r=e.get(a);r.sources.push(i),e.set(a,r)}else e.set(a,{sources:[i],mqs:this.getMQs(a)})}),g(this,"img").forEach(i=>{let a=i.dataset.dvaMq;a===void 0&&(a="1-5");const r=i.dataset.src;if(e.has(a)&&r!==void 0){const n=e.get(a);n.fallbackSrc=r,e.set(a,n)}}),this.videoSources=e,e}get activeVideo(){const t=parseInt(E(f).slice(2),10),e=[];let s=0;return this.sources.forEach(i=>{x(i.mqs,t)&&e.push(s),s+=1}),e.length?e[0]:0}handleIntersectionChange(){this.viewportObserver.unobserve(this),o(this,D),c(this,h,this.handleIntersectionChange,this),this.setState({activeRendition:this.activeVideo})}handleMQChange(){this.setState({activeRendition:this.activeVideo})}handleVideoLoad(t){c(t.target,"loadeddata",this.handleVideoLoad,this),o(this,v),o(this,u),o(this.ui.video[this.state.activeRendition],v)}handleVideoLoadingError(t){c(t.target,"error",this.handleVideoLoadingError,this);const e=this.ui.video[this.state.activeRendition];o(this,v),o(this,u),o(e,v)}loadVideo(){if(this.ui.video.length<=this.state.activeRendition)return;this.unloadVideo();const t=this.ui.video[this.state.activeRendition],e=g(t,"source");C(t,"loadeddata",this.handleVideoLoad,this),C(e[e.length-1],"error",this.handleVideoLoadingError,this),e.forEach(s=>{const i=s.dataset.src;i!==void 0&&s.setAttribute("src",i)}),t.load()}unloadVideo(){l(this.ui.video,v),l(this,v),l(this,u)}getMQs(t){let e=[];return z(t).split(",").forEach(s=>{if(s.length===1)e=w(e,parseInt(s,10));else if(s.length>1){const i=s.split("-"),a=parseInt(i[0],10),r=parseInt(i[1],10);for(let n=a;n<=r;n++)e=w(e,n)}}),e}};p=W([P(f)],p);customElements.define("dva-e-lazy-video",p);const G=(t,e,s)=>m`<dva-e-icon class="dva-e-rating-star${t!=="no"?` dva-e-rating-star--${t}`:""}" icon-id="dva-icon-star" ?half-filled="${t==="half"}" @click="${()=>{s.editMode&&(s.rating=e+1)}}"></dva-e-icon>`,K=(t,e)=>e+.5<t,Z=(t,e)=>e+1>t&&e+.1<=t,J=t=>new Array(5).fill(!0).map((e,s)=>K(t.curRating,s)?"full":Z(t.curRating,s)?"half":"no"),X=t=>m`<div class="dva-m-rating-box__ratingstar-wrapper">${J(t).map((e,s)=>G(e,s,t.ratingBox))}</div><span class="dvag-e-form-field__error"><dva-e-icon class="dvag-e-form-field__error-icon" icon-id="dva-icon-error-16px"></dva-e-icon>Bitte bewerten Sie.</span>`;var Y=Object.defineProperty,F=Object.getOwnPropertyDescriptor,k=(t,e,s,i)=>{for(var a=i>1?void 0:i?F(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(a=(i?n(e,s,a):n(a))||a);return i&&a&&Y(e,s,a),a};class I extends _{constructor(){super({events:[{event:h,target:"this",handler:"handleIntersectionChange"}],initialStates:{loaded:!1,inValidationMode:!1},reactions:{inValidationMode:["renderComponent"]}}),this.viewportObserver=V.getInstance(),this.editMode=!1}static get observedAttributes(){return["rating"]}attributeChangedCallback(e,s,i){e==="rating"&&s!==i&&this.state.initialized&&this.renderComponent()}afterComponentRender(){this.viewportObserver.observe(this)}get rating(){return parseFloat((this.getAttribute("rating")||"5").replace(",","."))}set rating(e){this.setAttribute("rating",e.toString())}get name(){return this.getAttribute("name")||""}handleIntersectionChange(){this.viewportObserver.unobserve(this),c(this,h,this.handleIntersectionChange,this),this.state.loaded||this.renderComponent()}renderComponent(){this.state.inValidationMode&&L(this,A,this.rating===0),S(X({curRating:this.rating,ratingBox:this}),this)}validate(){this.editMode&&this.setState({inValidationMode:!0})}}k([q],I.prototype,"editMode",2);customElements.define("dva-m-rating-box",I);var ee=Object.defineProperty,te=Object.getOwnPropertyDescriptor,R=(t,e,s,i)=>{for(var a=i>1?void 0:i?te(e,s):e,r=t.length-1,n;r>=0;r--)(n=t[r])&&(a=(i?n(e,s,a):n(a))||a);return i&&a&&ee(e,s,a),a};class b extends _{afterComponentRender(){this.checkButtonModifier(),this.setButtonClass()}checkButtonModifier(){y(this,"dvag-m-c04-vb-stage--no-vb-image")&&o(this.stageCta,"dva-e-button--white")}setButtonClass(){if(y(this,"dvag-m-c04-vb-stage--no-vb-image"))return;const e=E(f);e==="MQ4"||e==="MQ5"?o(this.stageCta,"dva-e-button--white"):l(this.stageCta,"dva-e-button--white")}}R([B(".dvag-m-c04-vb-stage__cta")],b.prototype,"stageCta",2);R([j("window",$)],b.prototype,"setButtonClass",1);customElements.define("dvag-m-c04-vb-stage",b);const M=t=>`${window.hlx.codeBasePath}/dist/video/${t}`,ae=({description:t,image:e,name:s,rating:i,titel:a,videoFallback:r,videoName:n})=>m`<div class="c04-vbstage dvag-h-margin-bottom--none"><dvag-m-c04-vb-stage class="dvag-m-c04-vb-stage" id="c04-vb-stage"><div class="dvag-m-c04-vb-stage__background-wrapper"><dva-e-lazy-video class="dva-e-lazy-video dva-h-preload dva-h-preload__4-3--mq-1-3 dva-h-preload__21-9--mq-4-and-up dvag-m-c04-vb-stage__background-video dva-state-invp dva-state-loaded dva-state-initialized"><video class="dva-e-lazy-video__video dva-js-lazy-video__video" autoplay="" muted="" loop="" playsinline="" poster="${r==null?void 0:r.src}"><source data-src="${M(n)}.754.564.mp4" type="dist/video/mp4" data-dva-mq="1-3"></video><video class="dva-e-lazy-video__video dva-js-lazy-video__video dva-state-loaded" autoplay="" muted="" loop="" playsinline="" poster="${r==null?void 0:r.src}"><source data-src="${M(n)}.1200.500.mp4" type="video/mp4" data-dva-mq="4-5" poster="${r==null?void 0:r.src}"></video></dva-e-lazy-video><div class="dvag-m-c04-vb-stage__skewed-box"><div class="dva-h-skew--in"></div><div class="dva-m-skewed-box__content"></div><div class="dva-h-skew--out"></div></div></div><div class="dvag-m-c04-vb-stage__content-wrapper"><div class="dvag-m-c04-vb-stage__vb-image"><div class="dvag-m-c04-vb-stage__vb-image-wrapper"><dva-e-lazy-image class="dva-e-lazy-image dva-js-lazy-image dvag-m-c04-vb-stage__vb-portrait dva-state-initialized dva-state-invp dva-state-loaded" src="${e==null?void 0:e.src}" alt="${e==null?void 0:e.alt}" aspect-ratio="1:1"></dva-e-lazy-image></div></div><div class="dvag-m-c04-vb-stage__vb-content"><div class="dvag-m-c04-vb-stage__vb-inner-content"><div class="dvag-m-c04-vb-stage__rating-wrapper"><dva-m-rating-box class="dva-m-rating-box" rating="${i}"><div class="dva-m-rating-box__ratingstar-wrapper"></div><span class="dvag-e-form-field__error"><dva-e-icon class="dvag-e-form-field__error-icon" icon-id="dva-icon-error-16px"></dva-e-icon>Bitte bewerten Sie.</span></dva-m-rating-box><p class="dvag-m-c04-vb-stage__rating-label">5 von 5 Sternen<a class="dvag-m-c04-vb-stage__rating-link" href="#">15 Bewertungen</a></p></div><p class="dvag-m-c04-vb-stage__vb-name">${s}</p><p class="dvag-m-c04-vb-stage__vb-info">${t}</p><p class="dvag-m-c04-vb-stage__vb-title">${a}</p><dvag-e-c26-vb-contact-overlay-toggle class="dvag-e-c26-vb-contact-overlay-toggle dva-e-button dva-e-button--rebrush dva-e-button--small dvag-m-c04-vb-stage__cta dva-e-button--white dva-state-active" id="contact_c04-vb-stage" no-cookie-hide="no-cookie-hide"><div class="dva-e-button__background"></div><span class="dva-e-button__label">Kontakt aufnehmen</span><dva-e-icon class="dva-e-button__icon" icon-id="dva-icon-contact-new"></dva-e-icon></dvag-e-c26-vb-contact-overlay-toggle></div></div></div></dvag-m-c04-vb-stage></div>`,d=(t,e)=>{var i;return((i=t.children[e].textContent)==null?void 0:i.trim())??""},se=(t,e)=>parseInt(d(t,e),10)||0,ie=(t,e)=>parseFloat(d(t,e))||0,re=(t,e)=>{const s=ie(t,e),i=Math.min(Math.max(s,.5),5);return Math.round(i*2)/2};function we(t){const e={image:t.children[0].querySelector("img")??void 0,videoFallback:t.children[1].querySelector("img")??void 0,videoName:d(t,2),name:d(t,3),description:d(t,4),titel:d(t,5),rating:re(t,6),shared:se(t,7),buttonLabel:d(t,8)};O(t),S(ae(e),t)}export{we as default};
//# sourceMappingURL=vb-stage.js.map
