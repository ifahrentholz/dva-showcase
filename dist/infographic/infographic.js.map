{"version":3,"file":"infographic.js","sources":["../../src/components/dvag-m-c22-infographic/dvag-m-c22-infographic.ts","../../src/blocks/infographic/infographic.ts"],"sourcesContent":["import { Component, uiEvent } from \"@kluntje/core\";\nimport { addClass, getCurrentMQ, waitFor } from \"@kluntje/js-utils/lib/dom-helpers\";\nimport { MediaQueryService, ViewportObserver } from \"@kluntje/services\";\nimport mqDefinitions from \"Config/mediaQueries\";\nimport { ANIMATING } from \"Constants/cssClasses\";\nimport { IN_VIEWPORT_EVENT, MQ_CHANGE_EVENT } from \"Constants/eventTypes\";\n\nexport class DvagC22Infographic extends Component {\n  viewportObserver = ViewportObserver.getInstance();\n  mqService: MediaQueryService = MediaQueryService.getInstance(mqDefinitions);\n  currentMode = \"\";\n  loaded = false;\n\n  constructor() {\n    super({});\n    this.currentMode = \"\";\n    this.loaded = false;\n  }\n\n  /**\n   * Returns URL of SVG for desktop viewports provided as attribute\n   * @returns {string}\n   */\n  get desktopUrl(): string {\n    return this.getAttribute(\"desktop-url\") || \"\";\n  }\n\n  /**\n   * Returns (optional) URL of SVG for mobile viewports provided as attribute\n   * @returns {string}\n   */\n  get mobileUrl(): string {\n    return this.getAttribute(\"mobile-url\") || this.desktopUrl;\n  }\n\n  /**\n   * Returns current MQ\n   * @returns {string}\n   */\n  get currentMQ() {\n    return getCurrentMQ(mqDefinitions);\n  }\n\n  /**\n   * adds viewportObserver\n   * @override\n   */\n  afterComponentRender(): void {\n    this.viewportObserver.observe(this);\n  }\n\n  /**\n   * Adds svg-data and triggers animation\n   * @param {string} svgData\n   */\n  async addSvgMarkup(svgData: string) {\n    if (svgData) this.innerHTML = svgData;\n    await waitFor(500);\n    addClass(this, ANIMATING);\n  }\n\n  /**\n   * Adds image-markup in case file is not a .svg-file\n   * @param {string} url\n   */\n  addImageMarkup(url: string) {\n    const imageMarkup = `<dva-e-lazy-image\n        class=\"dva-e-lazy-image\"\n        src=${url}\n      ></dva-e-lazy-image>`;\n    this.loaded = true;\n    this.innerHTML = imageMarkup;\n  }\n\n  /**\n   * Loads SVG-file from given attribute\n   * @param {string} url\n   */\n  async loadFile(url: string) {\n    if (url !== \"\") {\n      if (url.endsWith(\".svg\")) {\n        const svgData = await fetch(url).then(response => {\n          if (!response.ok) {\n            throw Error(`SVG Animation ${url} could not be loaded: ${response.statusText}`);\n          }\n          return response.text();\n        });\n        this.loaded = true;\n        this.addSvgMarkup(svgData);\n      } else {\n        this.addImageMarkup(url);\n      }\n    }\n  }\n\n  /**\n   * Updates loaded file regarding to currentMQ\n   * @param {string} mq\n   */\n  updateFile(mq: string) {\n    const bpNum = parseInt(mq.charAt(2), 10);\n    if (bpNum < 3 && this.currentMode !== \"mobile\") {\n      // switch to mobile mode\n      this.currentMode = \"mobile\";\n      this.loaded = false;\n      this.loadFile(this.mobileUrl);\n    } else if (bpNum >= 3 && this.currentMode !== \"desktop\") {\n      this.currentMode = \"desktop\";\n      this.loaded = false;\n      this.loadFile(this.desktopUrl);\n    }\n  }\n\n  @uiEvent(\"this\", IN_VIEWPORT_EVENT)\n  handleIntersectionChange() {\n    this.viewportObserver.unobserve(this);\n    if (!this.loaded) this.updateFile(this.currentMQ);\n  }\n\n  @uiEvent(\"window\", MQ_CHANGE_EVENT)\n  handleMQChange() {\n    this.updateFile(this.currentMQ);\n  }\n}\n\ncustomElements.define(\"dvag-m-c22-infographic\", DvagC22Infographic);\n","import { cleanUpBlock } from \"Utils/cleanUpBlock\";\nimport { html, render } from \"lit\";\nimport \"Components/dvag-m-c22-infographic/dvag-m-c22-infographic\";\nimport \"./infographic.scss\";\n\ninterface InfographicTemplateArgs {\n  desktopImage: string;\n  mobileImage: string;\n}\n\nconst infographicTemplate = (args: InfographicTemplateArgs) => {\n  return html`\n    <div class=\"dvag-m-c28-content-container dvag-m-c28-content-container--8-cols \">\n      <div class=\"dvag-m-c28-content-container__content-wrapper wcm-io-parsys\">\n        <div class=\"c22-infographic\">\n          <dvag-m-c22-infographic\n            class=\"dvag-m-c22-infographic\"\n            desktop-url=\"${args.desktopImage}\"\n            mobile-url=\"${args.mobileImage}\"\n          >\n          </dvag-m-c22-infographic>\n        </div>\n      </div>\n    </div>\n  `;\n};\n\nexport default function (block: HTMLElement) {\n  const desktopImage = block.children[0].textContent || \"\";\n  const mobileImage = block.children[1].textContent || \"\";\n\n  cleanUpBlock(block);\n\n  render(infographicTemplate({ desktopImage, mobileImage }), block);\n}\n"],"names":["DvagC22Infographic","Component","ViewportObserver","MediaQueryService","mqDefinitions","getCurrentMQ","svgData","waitFor","addClass","ANIMATING","url","imageMarkup","response","mq","bpNum","__decorateClass","uiEvent","IN_VIEWPORT_EVENT","MQ_CHANGE_EVENT","infographicTemplate","args","html","infographic","block","desktopImage","mobileImage","cleanUpBlock","render"],"mappings":"6oBAOO,MAAMA,UAA2BC,CAAU,CAMhD,aAAc,CACZ,MAAM,CAAE,CAAA,EANV,KAAA,iBAAmBC,EAAiB,cACL,KAAA,UAAAC,EAAkB,YAAYC,CAAa,EAC5D,KAAA,YAAA,GACL,KAAA,OAAA,GAIP,KAAK,YAAc,GACnB,KAAK,OAAS,EAChB,CAMA,IAAI,YAAqB,CAChB,OAAA,KAAK,aAAa,aAAa,GAAK,EAC7C,CAMA,IAAI,WAAoB,CACtB,OAAO,KAAK,aAAa,YAAY,GAAK,KAAK,UACjD,CAMA,IAAI,WAAY,CACd,OAAOC,EAAaD,CAAa,CACnC,CAMA,sBAA6B,CACtB,KAAA,iBAAiB,QAAQ,IAAI,CACpC,CAMA,MAAM,aAAaE,EAAiB,CAC9BA,IAAS,KAAK,UAAYA,GAC9B,MAAMC,EAAQ,GAAG,EACjBC,EAAS,KAAMC,CAAS,CAC1B,CAMA,eAAeC,EAAa,CAC1B,MAAMC,EAAc;AAAA;AAAA,cAEVD,CAAG;AAAA,4BAEb,KAAK,OAAS,GACd,KAAK,UAAYC,CACnB,CAMA,MAAM,SAASD,EAAa,CAC1B,GAAIA,IAAQ,GACN,GAAAA,EAAI,SAAS,MAAM,EAAG,CACxB,MAAMJ,EAAU,MAAM,MAAMI,CAAG,EAAE,KAAiBE,GAAA,CAC5C,GAAA,CAACA,EAAS,GACZ,MAAM,MAAM,iBAAiBF,CAAG,yBAAyBE,EAAS,UAAU,EAAE,EAEhF,OAAOA,EAAS,MAAK,CACtB,EACD,KAAK,OAAS,GACd,KAAK,aAAaN,CAAO,CAAA,MAEzB,KAAK,eAAeI,CAAG,CAG7B,CAMA,WAAWG,EAAY,CACrB,MAAMC,EAAQ,SAASD,EAAG,OAAO,CAAC,EAAG,EAAE,EACnCC,EAAQ,GAAK,KAAK,cAAgB,UAEpC,KAAK,YAAc,SACnB,KAAK,OAAS,GACT,KAAA,SAAS,KAAK,SAAS,GACnBA,GAAS,GAAK,KAAK,cAAgB,YAC5C,KAAK,YAAc,UACnB,KAAK,OAAS,GACT,KAAA,SAAS,KAAK,UAAU,EAEjC,CAGA,0BAA2B,CACpB,KAAA,iBAAiB,UAAU,IAAI,EAC/B,KAAK,QAAa,KAAA,WAAW,KAAK,SAAS,CAClD,CAGA,gBAAiB,CACV,KAAA,WAAW,KAAK,SAAS,CAChC,CACF,CATEC,EAAA,CADCC,EAAQ,OAAQC,CAAiB,CAAA,EA1GvBjB,EA2GX,UAAA,2BAAA,CAAA,EAMAe,EAAA,CADCC,EAAQ,SAAUE,CAAe,CAAA,EAhHvBlB,EAiHX,UAAA,iBAAA,CAAA,EAKF,eAAe,OAAO,yBAA0BA,CAAkB,ECnHlE,MAAMmB,EAAuBC,GACpBC,6PAMkBD,EAAK,YAAY,iBAClBA,EAAK,WAAW,gDAS1C,SAAAE,EAAyBC,EAAoB,CAC3C,MAAMC,EAAeD,EAAM,SAAS,CAAC,EAAE,aAAe,GAChDE,EAAcF,EAAM,SAAS,CAAC,EAAE,aAAe,GAErDG,EAAaH,CAAK,EAElBI,EAAOR,EAAoB,CAAE,aAAAK,EAAc,YAAAC,CAAa,CAAA,EAAGF,CAAK,CAClE"}